<h1 id="hud-development">hud development</h1>
<p>Notes, testing and code for chart-svg develoment.</p>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE DataKinds #-}</span>
<span class="ot">{-# LANGUAGE FlexibleContexts #-}</span>
<span class="ot">{-# LANGUAGE FlexibleInstances #-}</span>
<span class="ot">{-# LANGUAGE MonoLocalBinds #-}</span>
<span class="ot">{-# LANGUAGE NoImplicitPrelude #-}</span>
<span class="ot">{-# LANGUAGE OverloadedLabels #-}</span>
<span class="ot">{-# LANGUAGE OverloadedLists #-}</span>
<span class="ot">{-# LANGUAGE OverloadedStrings #-}</span>
<span class="ot">{-# LANGUAGE RankNTypes #-}</span>
<span class="ot">{-# LANGUAGE RebindableSyntax #-}</span>
<span class="ot">{-# LANGUAGE ScopedTypeVariables #-}</span>
<span class="ot">{-# LANGUAGE TypeApplications #-}</span>
<span class="ot">{-# LANGUAGE TypeFamilies #-}</span>
<span class="ot">{-# LANGUAGE TypeOperators #-}</span>
<span class="ot">{-# OPTIONS_GHC -Wall #-}</span>

<span class="kw">import </span><span class="dt">Chart.Svg</span>
<span class="kw">import </span><span class="dt">NumHask.Prelude</span>
<span class="kw">import </span><span class="dt">Lens.Micro</span>
<span class="kw">import </span><span class="dt">Codec.Picture.Types</span>
<span class="kw">import </span><span class="dt">Data.Generics.Product</span> (field)
<span class="kw">import </span><span class="dt">Chart.Hud</span>
<span class="kw">import </span><span class="dt">Chart.Core</span>
<span class="kw">import </span><span class="dt">Chart.Spot</span>
<span class="kw">import </span><span class="dt">Graphics.Svg.Types</span> <span class="kw">as</span> <span class="dt">Svg</span> <span class="kw">hiding</span> (<span class="dt">Point</span>, <span class="dt">Text</span>)</code></pre></div>
<p>A Chart consists of a few conceptual layers:</p>
<h2 id="data-to-be-represented">data to be represented</h2>
<p>Data for chart-svg charts is typically a double-list of either points or rectangles. The data below are three simple lines.</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell">
<span class="ot">ls ::</span> [[<span class="dt">Point</span> <span class="dt">Double</span>]]
ls <span class="fu">=</span>
  map (uncurry <span class="dt">Point</span>) <span class="fu">&lt;$&gt;</span>
  [ [(<span class="fl">0.0</span>, <span class="fl">1.0</span>), (<span class="fl">1.0</span>, <span class="fl">1.0</span>), (<span class="fl">2.0</span>, <span class="fl">5.0</span>)]
  , [(<span class="fl">0.0</span>, <span class="fl">0.0</span>), (<span class="fl">3.0</span>, <span class="fl">3.0</span>)]
  , [(<span class="fl">0.5</span>, <span class="fl">4.0</span>), (<span class="fl">0.5</span>, <span class="dv">0</span>)]
  ]</code></pre></div>
<h2 id="manifest-representations-of-the-data">manifest representations of the data</h2>
<p>Physical, on-the-page representations of data are separate to the data itself.</p>
<p>chart-svg categorises representations into different style categories. The code below specifies a line style for representing chart data, with differing colors and line widths.</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell">
<span class="ot">gopts ::</span> [<span class="dt">GlyphStyle</span>]
gopts <span class="fu">=</span>
  [ field <span class="fu">@</span><span class="st">&quot;borderSize&quot;</span> <span class="fu">.~</span> <span class="dv">0</span> <span class="fu">$</span>
    field <span class="fu">@</span><span class="st">&quot;size&quot;</span> <span class="fu">.~</span> <span class="fl">0.1</span> <span class="fu">$</span>
    defaultGlyphStyle
  , field <span class="fu">@</span><span class="st">&quot;borderSize&quot;</span> <span class="fu">.~</span> <span class="dv">0</span> <span class="fu">$</span>
    field <span class="fu">@</span><span class="st">&quot;size&quot;</span> <span class="fu">.~</span> <span class="fl">0.1</span> <span class="fu">$</span>
    field <span class="fu">@</span><span class="st">&quot;color&quot;</span> <span class="fu">.~</span> <span class="dt">PixelRGBA8</span> <span class="dv">100</span> <span class="dv">30</span> <span class="dv">30</span> <span class="dv">100</span> <span class="fu">$</span>
    field <span class="fu">@</span><span class="st">&quot;shape&quot;</span> <span class="fu">.~</span> <span class="dt">RectRoundedGlyph</span> <span class="fl">1.5</span> <span class="fl">0.01</span> (<span class="fl">0.01</span><span class="ot"> ::</span> <span class="dt">Double</span>) <span class="fu">$</span>
    defaultGlyphStyle
  , field <span class="fu">@</span><span class="st">&quot;borderSize&quot;</span> <span class="fu">.~</span> <span class="dv">0</span> <span class="fu">$</span>
    field <span class="fu">@</span><span class="st">&quot;size&quot;</span> <span class="fu">.~</span> <span class="fl">0.1</span> <span class="fu">$</span>
    field <span class="fu">@</span><span class="st">&quot;color&quot;</span> <span class="fu">.~</span> <span class="dt">PixelRGBA8</span> <span class="dv">100</span> <span class="dv">130</span> <span class="dv">80</span> <span class="dv">100</span> <span class="fu">$</span>
    field <span class="fu">@</span><span class="st">&quot;shape&quot;</span> <span class="fu">.~</span> <span class="dt">EllipseGlyph</span> <span class="fl">1.5</span> <span class="fu">$</span>
    defaultGlyphStyle
  ]</code></pre></div>
<p>and this is enough to create a chart:</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell">
<span class="ot">glyphs ::</span> [<span class="dt">Chart</span> <span class="dt">Double</span>]
glyphs <span class="fu">=</span> zipWith (\d s <span class="ot">-&gt;</span> <span class="dt">Chart</span> (<span class="dt">GlyphA</span> s) mempty (<span class="dt">SpotPoint</span> <span class="fu">&lt;$&gt;</span> d)) ls gopts</code></pre></div>
<div class="figure">
<img src="other/glyphs.svg" />

</div>
<p>This layering is not exactly canonical. <a href="http://r4ds.had.co.nz/visualize.html">ggplot2</a> uses the term <a href="https://ggplot2.tidyverse.org/reference/aes.html">aesthetics</a> for the process of deciding which features of the data will be brought out in the visualisation, so that style is seen as a function of the data.</p>
<p>By clearly specifying what is a position on the page (the Spot) from what may be some other style decision (the color or shape of a geometric object), however, other chart features, such as grid-lines and axes, can reuse the same functionality used to build the data representation.</p>
<h1 id="the-hud">3. the hud</h1>
<p>In addition to raw data, and to the manifestation of that data on a physical plane, a chart usually includes decoration that assists in interpreting the chart data - axes, grid lines, titles, legends and friends that visual explain what is being seen in the chart.</p>
<p>chart-svg calls this decoration the heads-up-display - the hud.</p>
<p>The remainder of this *.lhs records hud development.</p>
<h2 id="decorating-the-canvas">decorating the canvas</h2>
<p>huds are different to pure chart data only in the sense that they require both information on the raw data (eg data ranges to calculate tick values) and information on the representation (eg how wide the chart is to properly locate the tick text on the page)</p>
<p>The xy-plane on which the data is represented - the canvas - is a good place to tease this out.</p>
<p>chart-svg and, specifically, <code>chartSvg</code> recognises that the physical representation of a data point may fall outside the data range, so that the viewbox becomes wider than the raw data suggests.</p>
<p>Here's an attempt to create a background canvas for our example chart corners:</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell">
<span class="ot">corners ::</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> [<span class="dt">Chart</span> <span class="dt">Double</span>]
corners s <span class="fu">=</span>
  [<span class="dt">Chart</span>
  (<span class="dt">GlyphA</span> <span class="fu">$</span>
   field <span class="fu">@</span><span class="st">&quot;borderSize&quot;</span> <span class="fu">.~</span> <span class="dv">0</span> <span class="fu">$</span>
    field <span class="fu">@</span><span class="st">&quot;size&quot;</span> <span class="fu">.~</span> s <span class="fu">$</span>
    defaultGlyphStyle)
  mempty
  [<span class="dt">SP</span> (<span class="fu">-</span><span class="fl">0.5</span>) (<span class="fu">-</span><span class="fl">0.5</span>), <span class="dt">SP</span> (<span class="fu">-</span><span class="fl">0.5</span>) <span class="fl">0.5</span>, <span class="dt">SP</span> <span class="fl">0.5</span> (<span class="fu">-</span><span class="fl">0.5</span>), <span class="dt">SP</span> <span class="fl">0.5</span> <span class="fl">0.5</span>]]

<span class="ot">canvas1 ::</span> <span class="dt">ChartSvg</span> <span class="dt">Double</span>
canvas1 <span class="fu">=</span> chartSvg one (corners <span class="fl">0.1</span> <span class="fu">&lt;&gt;</span> [<span class="dt">Chart</span> (<span class="dt">RectA</span> (blob grey <span class="fl">0.2</span>)) mempty [one]])</code></pre></div>
<p><br> <img src="other/canvas1.svg" /> <br></p>
<p>The canvas has to take into account the data area and the physical representation of the data; in this case the circle size of the data points.</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell">
<span class="ot">canvas2 ::</span> (<span class="dt">ToRatio</span> a, <span class="dt">FromRatio</span> a, <span class="dt">Subtractive</span> a, <span class="dt">Field</span> a, <span class="dt">BoundedLattice</span> a) <span class="ot">=&gt;</span> <span class="dt">ViewBox</span> a <span class="ot">-&gt;</span> [<span class="dt">Chart</span> a] <span class="ot">-&gt;</span> <span class="dt">ChartSvg</span> a
canvas2 (<span class="dt">ViewBox</span> asp) cs <span class="fu">=</span>
  chartSvg_ (<span class="dt">ViewBox</span> asp&#39;) (cs&#39; <span class="fu">&lt;&gt;</span> [canvas&#39;])
  <span class="kw">where</span>
    cs&#39; <span class="fu">=</span> projectSpots asp cs
    asp&#39; <span class="fu">=</span> styleBoxes cs&#39;
    canvas&#39; <span class="fu">=</span> <span class="dt">Chart</span> (<span class="dt">RectA</span> (blob grey <span class="fl">0.2</span>)) mempty
      [<span class="dt">SpotArea</span> asp&#39;]</code></pre></div>
<p><br> <img src="other/canvas2.svg" /> <br></p>
<p>So the introduction of a hud to a chart requires a different api to chartSvg. Together with a list of Charts and a ViewBox, we require a function that takes in a ViewBox - the viewbox of the main chart list - and gives back a list of Charts which is the pre-rendered hud.</p>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell">
<span class="ot">canvas3 ::</span> <span class="dt">Hud</span> a
canvas3 <span class="fu">=</span> canvas (blob grey <span class="fl">0.2</span>) mempty</code></pre></div>
<p><code>hudSvg one canvas3 (corners 0.25)</code></p>
<p><br> <img src="other/canvas3.svg" /> <br></p>
<h2 id="basic-axis-bars-and-titles">basic axis bars and titles</h2>
<p>Building the Hud includes a layering process: the next Hud element being added (which is a [Chart a]) takes into account the ViewBox of the chart and all the previous hud elements.</p>
<p>The <code>foldl layer mempty</code> fold of the Huds effectively forgets what is the chart and what are the hud elements, and text anchoring cannot reference the original chart rep.</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell">
<span class="ot">b1 ::</span> [<span class="dt">Bar</span> <span class="dt">Double</span>]
b1 <span class="fu">=</span>
  [ <span class="dt">Bar</span> <span class="dt">PlaceTop</span> defaultRectStyle <span class="fl">0.05</span> <span class="fl">0.02</span>
  , <span class="dt">Bar</span> <span class="dt">PlaceRight</span> defaultRectStyle <span class="fl">0.05</span> <span class="fl">0.02</span>
  , <span class="dt">Bar</span> <span class="dt">PlaceBottom</span> defaultRectStyle <span class="fl">0.05</span> <span class="fl">0.02</span>
  , <span class="dt">Bar</span> <span class="dt">PlaceLeft</span> defaultRectStyle <span class="fl">0.05</span> <span class="fl">0.02</span>
  ]

<span class="ot">t1 ::</span> [<span class="dt">Title</span> <span class="dt">Double</span>]
t1 <span class="fu">=</span> (\a p <span class="ot">-&gt;</span> (field <span class="fu">@</span><span class="st">&quot;place&quot;</span> <span class="fu">.~</span><span class="ot"> p ::</span> <span class="dt">Title</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Title</span> <span class="dt">Double</span>) <span class="fu">$</span>
        field <span class="fu">@</span><span class="st">&quot;align&quot;</span> <span class="fu">.~</span> a <span class="fu">$</span>
        defaultTitle (show a <span class="fu">&lt;&gt;</span> <span class="st">&quot;:&quot;</span> <span class="fu">&lt;&gt;</span> show p)) <span class="fu">&lt;$&gt;</span>
      [<span class="dt">TextAnchorStart</span>, <span class="dt">TextAnchorMiddle</span>, <span class="dt">TextAnchorEnd</span>] <span class="fu">&lt;*&gt;</span>
      [<span class="dt">PlaceBottom</span>, <span class="dt">PlaceTop</span>, <span class="dt">PlaceLeft</span>, <span class="dt">PlaceRight</span>]

<span class="ot">hud1 ::</span> <span class="dt">ViewBox</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> [<span class="dt">Chart</span> <span class="dt">Double</span>] <span class="ot">-&gt;</span> <span class="dt">ChartSvg</span> <span class="dt">Double</span>
hud1 vb cs <span class="fu">=</span>
  hudSvg vb [c, b, t] cs
  <span class="kw">where</span>
    c <span class="fu">=</span> canvas (blob grey <span class="fl">0.2</span>) mempty
    b <span class="fu">=</span> mconcat <span class="fu">$</span> (\x <span class="ot">-&gt;</span> bar x mempty) <span class="fu">&lt;$&gt;</span> b1
    t <span class="fu">=</span> foldl layer mempty <span class="fu">$</span> (\x <span class="ot">-&gt;</span> title x mempty) <span class="fu">&lt;$&gt;</span>
      (((field <span class="fu">@</span><span class="st">&quot;place&quot;</span> <span class="fu">.~</span> <span class="dt">PlaceAbsolute</span> (<span class="dt">Point</span> <span class="dv">0</span> <span class="dv">0</span>)<span class="ot"> ::</span> <span class="dt">Title</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Title</span> <span class="dt">Double</span>) <span class="fu">$</span>
      defaultTitle <span class="st">&quot;PlaceAbsolute&quot;</span>) <span class="fu">:</span> t1)</code></pre></div>
<p><code>hud1 (aspect 1.5) glyphs</code></p>
<div class="figure">
<img src="other/hud1.svg" />

</div>
<p><code>fold</code> ignores the other Hud elements</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="ot">hud2 ::</span> <span class="dt">ViewBox</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> [<span class="dt">Chart</span> <span class="dt">Double</span>] <span class="ot">-&gt;</span> <span class="dt">ChartSvg</span> <span class="dt">Double</span>
hud2 vb cs <span class="fu">=</span>
  hudSvg vb [c, b, t] cs
  <span class="kw">where</span>
    c <span class="fu">=</span> canvas (blob grey <span class="fl">0.2</span>) mempty
    b <span class="fu">=</span> mconcat <span class="fu">$</span> (\x <span class="ot">-&gt;</span> bar x mempty) <span class="fu">&lt;$&gt;</span> b1
    t <span class="fu">=</span> fold <span class="fu">$</span> (\x <span class="ot">-&gt;</span> title x mempty) <span class="fu">&lt;$&gt;</span>
      (((field <span class="fu">@</span><span class="st">&quot;place&quot;</span> <span class="fu">.~</span> <span class="dt">PlaceAbsolute</span> (<span class="dt">Point</span> <span class="dv">0</span> <span class="dv">0</span>)<span class="ot"> ::</span> <span class="dt">Title</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Title</span> <span class="dt">Double</span>) <span class="fu">$</span>
      defaultTitle <span class="st">&quot;PlaceAbsolute&quot;</span>) <span class="fu">:</span> t1)</code></pre></div>
<div class="figure">
<img src="other/hud2.svg" />

</div>
<h2 id="tick-marks-and-labels">tick marks and labels</h2>
<p>Tick marks is an example of computing and placing Hud elements according to the original range of the data.</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell">
<span class="ot">hud3 ::</span> <span class="dt">ViewBox</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> [<span class="dt">Chart</span> <span class="dt">Double</span>] <span class="ot">-&gt;</span> <span class="dt">ChartSvg</span> <span class="dt">Double</span>
hud3 vb cs <span class="fu">=</span>
  hudSvg vb ([c, (bBot <span class="fu">&lt;&gt;</span> tBot <span class="fu">&lt;&gt;</span> bLeft <span class="fu">&lt;&gt;</span> tLeft <span class="fu">&lt;&gt;</span> bTop <span class="fu">&lt;&gt;</span> tTop <span class="fu">&lt;&gt;</span> bRight <span class="fu">&lt;&gt;</span> tRight)] <span class="fu">&lt;&gt;</span> t&#39;) cs
  <span class="kw">where</span>
    c <span class="fu">=</span> canvas (blob grey <span class="fl">0.2</span>) mempty
    bBot <span class="fu">=</span> bar (<span class="dt">Bar</span> <span class="dt">PlaceBottom</span> defaultRectStyle <span class="fl">0.005</span> <span class="fl">0.01</span>) mempty
    bLeft <span class="fu">=</span> bar (<span class="dt">Bar</span> <span class="dt">PlaceLeft</span> defaultRectStyle <span class="fl">0.005</span> <span class="fl">0.01</span>) mempty
    bTop <span class="fu">=</span> bar (<span class="dt">Bar</span> <span class="dt">PlaceTop</span> defaultRectStyle <span class="fl">0.005</span> <span class="fl">0.01</span>) mempty
    bRight <span class="fu">=</span> bar (<span class="dt">Bar</span> <span class="dt">PlaceRight</span> defaultRectStyle <span class="fl">0.005</span> <span class="fl">0.01</span>) mempty
    tBot <span class="fu">=</span> tickMarks defaultTick mempty
    tLeft <span class="fu">=</span> tickMarks ((field <span class="fu">@</span><span class="st">&quot;place&quot;</span> <span class="fu">.~</span> <span class="dt">PlaceLeft</span><span class="ot"> ::</span> <span class="dt">Tick</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Tick</span> <span class="dt">Double</span>) <span class="fu">$</span> defaultTick) mempty
    tTop <span class="fu">=</span> tickMarks ((field <span class="fu">@</span><span class="st">&quot;place&quot;</span> <span class="fu">.~</span> <span class="dt">PlaceTop</span><span class="ot"> ::</span> <span class="dt">Tick</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Tick</span> <span class="dt">Double</span>) <span class="fu">$</span> defaultTick) mempty
    tRight <span class="fu">=</span> tickMarks ((field <span class="fu">@</span><span class="st">&quot;place&quot;</span> <span class="fu">.~</span> <span class="dt">PlaceRight</span><span class="ot"> ::</span> <span class="dt">Tick</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Tick</span> <span class="dt">Double</span>) <span class="fu">$</span> defaultTick) mempty
    t&#39; <span class="fu">=</span> (\x <span class="ot">-&gt;</span> title ((field <span class="fu">@</span><span class="st">&quot;place&quot;</span> <span class="fu">.~</span><span class="ot"> x  ::</span> <span class="dt">Title</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Title</span> <span class="dt">Double</span>) <span class="fu">$</span> defaultTitle <span class="st">&quot;tick marks&quot;</span>) mempty) <span class="fu">&lt;$&gt;</span>
      ([<span class="dt">PlaceRight</span>, <span class="dt">PlaceLeft</span>, <span class="dt">PlaceTop</span>, <span class="dt">PlaceBottom</span>]<span class="ot"> ::</span> [<span class="dt">Place</span> <span class="dt">Double</span>])</code></pre></div>
<div class="figure">
<img src="other/hud3.svg" />

</div>
<p><br></p>
<h2 id="tick-label-rotation">tick label rotation</h2>
<p>Getting ticks to display sensibly can be labor intensive. Starting with some longer labels to illustrate the process:</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell">
<span class="ot">hud4 ::</span> <span class="dt">ViewBox</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> [<span class="dt">Chart</span> <span class="dt">Double</span>] <span class="ot">-&gt;</span> <span class="dt">ChartSvg</span> <span class="dt">Double</span>
hud4 vb cs <span class="fu">=</span>
  hudSvg vb ([c, (bBot <span class="fu">&lt;&gt;</span> tBot <span class="fu">&lt;&gt;</span> bLeft <span class="fu">&lt;&gt;</span> tLeft <span class="fu">&lt;&gt;</span> bTop <span class="fu">&lt;&gt;</span> tTop <span class="fu">&lt;&gt;</span> bRight <span class="fu">&lt;&gt;</span> tRight)] <span class="fu">&lt;&gt;</span> t&#39;) cs
  <span class="kw">where</span>
    labels <span class="fu">=</span> [<span class="st">&quot;tick labels&quot;</span>, <span class="st">&quot;often need to be&quot;</span>, <span class="st">&quot;manipulated&quot;</span>, <span class="st">&quot;by text anchoring&quot;</span>, <span class="st">&quot;, by rotation&quot;</span>, <span class="st">&quot;and by adjustments to font size&quot;</span>]<span class="ot"> ::</span> [<span class="dt">Text</span>]
    ts <span class="fu">=</span> (field <span class="fu">@</span><span class="st">&quot;tstyle&quot;</span> <span class="fu">.~</span> <span class="dt">TickLabels</span><span class="ot"> labels ::</span> <span class="dt">Tick</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Tick</span> <span class="dt">Double</span>) <span class="fu">$</span> defaultTick
    c <span class="fu">=</span> canvas (blob grey <span class="fl">0.2</span>) mempty
    bBot <span class="fu">=</span> bar (<span class="dt">Bar</span> <span class="dt">PlaceBottom</span> defaultRectStyle <span class="fl">0.005</span> <span class="fl">0.01</span>) mempty
    bLeft <span class="fu">=</span> bar (<span class="dt">Bar</span> <span class="dt">PlaceLeft</span> defaultRectStyle <span class="fl">0.005</span> <span class="fl">0.01</span>) mempty
    bTop <span class="fu">=</span> bar (<span class="dt">Bar</span> <span class="dt">PlaceTop</span> defaultRectStyle <span class="fl">0.005</span> <span class="fl">0.01</span>) mempty
    bRight <span class="fu">=</span> bar (<span class="dt">Bar</span> <span class="dt">PlaceRight</span> defaultRectStyle <span class="fl">0.005</span> <span class="fl">0.01</span>) mempty
<span class="ot">    tBot ::</span> <span class="dt">Hud</span> <span class="dt">Double</span>
    tBot <span class="fu">=</span> <span class="dt">Hud</span> <span class="fu">$</span> \vb&#39; a <span class="ot">-&gt;</span> <span class="kw">let</span> (ts&#39;,das&#39;) <span class="fu">=</span> adjustTick defaultAutoOptions vb&#39; a (ts, mempty) <span class="kw">in</span> <span class="kw">let</span> (<span class="dt">Hud</span> hud) <span class="fu">=</span> tick ts&#39; das&#39; <span class="kw">in</span> hud vb&#39; a
    tLeft <span class="fu">=</span> tickMarks ((field <span class="fu">@</span><span class="st">&quot;place&quot;</span> <span class="fu">.~</span> <span class="dt">PlaceLeft</span><span class="ot"> ::</span> <span class="dt">Tick</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Tick</span> <span class="dt">Double</span>) <span class="fu">$</span> ts) mempty
<span class="ot">    tTop ::</span> <span class="dt">Hud</span> <span class="dt">Double</span>
    tTop <span class="fu">=</span> <span class="dt">Hud</span> <span class="fu">$</span> \vb&#39; a <span class="ot">-&gt;</span> <span class="kw">let</span> (ts&#39;,das&#39;) <span class="fu">=</span> adjustTick defaultAutoOptions vb&#39; a ((field <span class="fu">@</span><span class="st">&quot;place&quot;</span> <span class="fu">.~</span> <span class="dt">PlaceTop</span><span class="ot"> ::</span> <span class="dt">Tick</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Tick</span> <span class="dt">Double</span>) <span class="fu">$</span> ts, mempty) <span class="kw">in</span> <span class="kw">let</span> (<span class="dt">Hud</span> hud) <span class="fu">=</span> tick ts&#39; das&#39; <span class="kw">in</span> hud vb&#39; a
    tRight <span class="fu">=</span> tickMarks ((field <span class="fu">@</span><span class="st">&quot;place&quot;</span> <span class="fu">.~</span> <span class="dt">PlaceRight</span><span class="ot"> ::</span> <span class="dt">Tick</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Tick</span> <span class="dt">Double</span>) <span class="fu">$</span> ts) mempty
    t&#39; <span class="fu">=</span> (\x <span class="ot">-&gt;</span> title ((field <span class="fu">@</span><span class="st">&quot;place&quot;</span> <span class="fu">.~</span><span class="ot"> x  ::</span> <span class="dt">Title</span> <span class="dt">Double</span> <span class="ot">-&gt;</span> <span class="dt">Title</span> <span class="dt">Double</span>) <span class="fu">$</span> defaultTitle <span class="st">&quot;automated tick style&quot;</span>) mempty) <span class="fu">&lt;$&gt;</span>
      ([<span class="dt">PlaceRight</span>, <span class="dt">PlaceLeft</span>, <span class="dt">PlaceTop</span>, <span class="dt">PlaceBottom</span>]<span class="ot"> ::</span> [<span class="dt">Place</span> <span class="dt">Double</span>])</code></pre></div>
<div class="figure">
<img src="other/hud4.svg" />

</div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell">
<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> <span class="kw">do</span>
  scratchWith
    ( clearScratchStyle <span class="fu">&amp;</span>
    field <span class="fu">@</span><span class="st">&quot;fileName&quot;</span> <span class="fu">.~</span> <span class="st">&quot;other/glyphs.svg&quot;</span> <span class="fu">&amp;</span>
    field <span class="fu">@</span><span class="st">&quot;ratioAspect&quot;</span> <span class="fu">.~</span> <span class="fl">1.5</span>) glyphs
  write <span class="st">&quot;other/canvas1.svg&quot;</span> (<span class="dt">Point</span> <span class="dv">200</span> <span class="dv">200</span>) canvas1
  write <span class="st">&quot;other/canvas2.svg&quot;</span> (<span class="dt">Point</span> <span class="dv">200</span> <span class="dv">200</span>) (canvas2 one (corners <span class="fl">0.2</span>))
  write <span class="st">&quot;other/canvas3.svg&quot;</span> (<span class="dt">Point</span> <span class="dv">200</span> <span class="dv">200</span>) (hudSvg one [canvas3] (corners <span class="fl">0.25</span>))
  write <span class="st">&quot;other/hud1.svg&quot;</span> (<span class="dt">Point</span> <span class="dv">400</span> <span class="dv">400</span>) <span class="fu">$</span> hud1 (aspect <span class="fl">1.5</span>) glyphs
  write <span class="st">&quot;other/hud2.svg&quot;</span> (<span class="dt">Point</span> <span class="dv">400</span> <span class="dv">400</span>) <span class="fu">$</span> hud2 (aspect <span class="fl">1.5</span>) glyphs
  write <span class="st">&quot;other/hud3.svg&quot;</span> (<span class="dt">Point</span> <span class="dv">400</span> <span class="dv">400</span>) <span class="fu">$</span> hud3 (aspect <span class="fl">1.5</span>) glyphs
  write <span class="st">&quot;other/hud4.svg&quot;</span> (<span class="dt">Point</span> <span class="dv">400</span> <span class="dv">400</span>) <span class="fu">$</span> hud4 (aspect <span class="fl">1.5</span>) glyphs</code></pre></div>
<p><br></p>
<p>λ&gt; workflow</p>
<p><br></p>
<pre><code>stack build --test --exec &quot;$(stack path --local-install-root)/bin/chart-hud&quot; --exec &quot;$(stack path --local-bin)/pandoc -f markdown+lhs -i other/header.md -i app/hud.lhs -i other/footer.md -t html -o hud.html --filter pandoc-include --mathjax&quot; --file-watch --ghc-options -freverse-errors</code></pre>
